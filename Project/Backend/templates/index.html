
<!doctype html>
<html>
<head>
<meta charset="utf-8"/>
<title>ShareAnywhere — Files & Text</title>
<style>
body{font-family: Arial, Helvetica, sans-serif; margin: 20px;}
.box{border:1px solid #ddd;padding:12px;margin-bottom:16px;border-radius:6px;}
input[type=file]{margin-bottom:8px}
.qr{width:140px;height:140px;border:1px solid #ccc;display:block;margin-top:8px}
textarea{width:100%;height:100px}
</style>
</head>
<body>
<h1>ShareAnywhere</h1>

<div class="box">
<h2>Send File(s)</h2>
<form id="fileForm" enctype="multipart/form-data" method="post" action="/upload">
<input type="file" name="files" id="files" multiple required><br>
Expiry (minutes): <input type="number" name="expiry_minutes" value="60" min="1" max="10080"><br><br>
<button type="submit">Upload</button>
</form>
<div id="fileResults"></div>
</div>

<div class="box">
<h2>Receive File</h2>
<form id="recvForm">
Enter PIN/Key: <input type="text" id="recvKey" required>
<button type="button" onclick="window.location='/receive?key='+document.getElementById('recvKey').value">Open</button>
</form>
<p>or scan QR code (for mobile)</p>
</div>

<div class="box">
<h2>Share Text</h2>
<textarea id="textToShare" placeholder="Type text..."></textarea><br>
Expiry (minutes): <input type="number" id="textExpiry" value="10" min="1" max="1440">
<button onclick="shareText()">Send & Generate PIN</button>
<div id="textShareResult"></div>
</div>

<div class="box">
<h2>Retrieve Text</h2>
<input type="text" id="pinInput" placeholder="Enter PIN">
<button onclick="openEditor()">Open Text</button>
</div>

<script>
document.getElementById('fileForm').onsubmit = async (e) => {
    e.preventDefault();
    const form = e.target;
    const fd = new FormData(form);
    const resp = await fetch('/upload', {method:'POST', body: fd});
    const data = await resp.json();
    const container = document.getElementById('fileResults');
    container.innerHTML = '';
    data.uploaded_files.forEach(item=>{
        const div = document.createElement('div');
        div.innerHTML = `<b>${item.file_names.join(', ')}</b> — PIN: <b>${item.file_key}</b><br>
                         <img src="${item.qr_url}" class="qr"><br>
                         <a href="/download/${item.file_key}" target="_blank">Download</a>`;
        container.appendChild(div);
    });
};

async function shareText(){
    const txt = document.getElementById('textToShare').value;
    const expiry = Number(document.getElementById('textExpiry').value) || 10;
    if(!txt.trim()){ alert('Enter text'); return; }
    const fd = new FormData();
    fd.append('text', txt);
    fd.append('expiry_minutes', expiry);
    const r = await fetch('/share_text', {method:'POST', body: fd});
    const data = await r.json();
    const res = document.getElementById('textShareResult');
    res.innerHTML = `PIN: <b>${data.pin}</b> — Expires: ${data.expiry}<br>
                     <img src="${data.qr_url}" class="qr"><br>
                     <a target="_blank" href="/edit/${data.pin}">Open Text</a>`;
}

function openEditor(){
    const pin = document.getElementById('pinInput').value.trim();
    if(!pin) return alert('Enter PIN');
    window.location = '/edit/' + pin;
}
</script>
</body>
</html>
